(function(){function c(a){a=a||{};if(!a.endpoint)throw"[warp] [ERROR] no endpoint defined!";this.channel=new c.Channel(a);this.params=a.params;this.ready=!1;this.buffer=[];var b=this;b.debug=a.debug?a.debug:!1;b.reconnectInterval=a.reconnectInterval?a.reconnectInterval:1E3;b.ssl=a.ssl?a.ssl:!1;b.ws=new ReconnectingWebSocket((a.ssl?"wss":"ws")+"://"+(a.endpoint+"/socket"),null,{debug:b.debug,reconnectInterval:b.reconnectInterval});b.ws.onopen=function(a){if(b.debug){var c={};c.type=a.type;c.timestamp=
a.timeStamp;console.info("[warp] open: "+JSON.stringify(c))}a=b.channel.all;0<a.length&&a.forEach(function(a){b._subscribe(a,b.channel.data[a])});b.ready=!0;b._sendBuffer()};b.ws.onclose=function(a){if(b.debug){var c={};c.type=a.type;c.timestamp=a.timeStamp;console.info("[warp]: "+JSON.stringify(c))}b.ready=!1};b.ws.onmessage=function(a){a=JSON.parse(a.data);b.debug&&console.debug("[warp] receive message: "+JSON.stringify(a));a.channel&&b.channel.get(a.channel)&&b.channel.get(a.channel)(a.msg)};b.ws.onerror=
function(a){b.debug&&(console.error("[warp] ERROR"),console.error(a))};b._sendJSON=function(a){b.debug&&console.debug("[warp] send message: "+JSON.stringify(a));b.ws.send(JSON.stringify(a))};b._sendBuffer=function(){b.buffer.forEach(function(a,c){setTimeout(function(){b._sendJSON(a)},100)});b.buffer=[]};b._send=function(a,c){var d={};d.channel=a;d.timestamp=Date.now();this.params&&(d.params=this.params);d.msg=c;b.ready?b._sendJSON(d):b.buffer.push(d)};b._subscribe=function(a,c){var d={};d.subscribe=
a;c&&(d.data=c);b._sendJSON(d)};b._close=function(){b.ws.close(1E3)}}c.prototype.subscribe=function(a,b,c){this.channel.add(a,b,c);this.ws.readyState?this._subscribe(a,c):(b={},b.subscribe=a,c&&(b.data=c),this.buffer.push(b))};c.prototype.unsubscribe=function(a){this.channel.remove(a)};c.prototype.beam=function(a,b){this._send(a,b)};c.prototype.allChannels=function(){return this.channel.all()};c.prototype.close=function(){this._close()};this.Warp=c}).call(this);
(function(){function c(a){a=a||{};this.debug=a.debug?a.debug:!1;this.channel={};this.data={}}c.prototype.add=function(a,b,c){this.channel[a]=b;this.data[a]=c;this.debug&&console.info("[warp]: subscribed to channel "+a)};c.prototype.get=function(a){return this.channel[a]};c.prototype.remove=function(a){delete this.channel[a];delete this.data[a]};c.prototype.all=function(){return Object.keys(this.channel)};Warp.Channel=c}).call(this);
