(function(){function c(a){a=a||{};this.channels=new c.Channels(a);this.params=a.params;this.ready=!1;this.buffer=[];var b=this;b.debug=a.debug?a.debug:!1;var e=new ReconnectingWebSocket("ws://"+((a.endpoint?a.endpoint:"localhost:9000")+"/socket"));e.onopen=function(a){if(b.debug){var d={};d.type=a.type;d.timestamp=a.timeStamp;console.log("[warp] open: "+JSON.stringify(d))}b.ready=!0;b._sendBuffer()};e.onclose=function(a){if(b.debug){var d={};d.type=a.type;d.timestamp=a.timeStamp;console.log("[warp]: "+
JSON.stringify(d))}};e.onmessage=function(a){a=JSON.parse(a.data);b.debug&&console.log("[warp] receive message: "+JSON.stringify(a));a.channel&&b.channels.get(a.channel)&&b.channels.get(a.channel)(a.msg)};e.onerror=function(a){b.debug&&console.log("[warp] ERROR: "+JSON.stringify(a))};b._sendJSON=function(a){b.debug&&console.log("[warp] send message: "+JSON.stringify(a));e.send(JSON.stringify(a))};b._sendBuffer=function(){b.buffer.forEach(function(a,d){setTimeout(function(){b._sendJSON(a)},100)});
b.buffer=[]};b._send=function(a,d){var c={};c.channel=a;c.timestamp=Date.now();this.params&&(c.params=this.params);c.msg=d;b.ready?b._sendJSON(c):b.buffer.push(c)};b._subscribe=function(a){var c={};c.subscribe=a;b.ready?b._sendJSON(c):b.buffer.push(c)};b._close=function(){e.close(1E3)}}c.prototype.subscribe=function(a,b){this.channels.add(a,b);this._subscribe(a)};c.prototype.unsubscribe=function(a){this.channels.remove(a)};c.prototype.beam=function(a,b){this._send(a,b)};c.prototype.allChannels=function(){return this.channels.all()};
c.prototype.close=function(){this._close()};this.Warp=c}).call(this);(function(){function c(a){a=a||{};this.debug=a.debug?a.debug:!1;this.channels={}}c.prototype.add=function(a,b){this.channels[a]=b;this.debug&&console.log("[warp]: subscribed to channel "+a)};c.prototype.get=function(a){return this.channels[a]};c.prototype.remove=function(a){delete this.channels[a]};c.prototype.all=function(){return Object.keys(this.channels)};Warp.Channels=c}).call(this);
